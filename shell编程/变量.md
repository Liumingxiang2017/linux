# 变量


bash变量的类型：
	本地变量(局部变量)
	环境变量
	位置变量: 
		$1, $2, ...
		shift
	特殊变量：

	
./filetest.sh /etc/fstab /etc/inittab
$1: /etc/fstab
$2: /etc/inittab

练习：写一脚本
能接受一个参数(文件路径)
判定：此参数如果是一个存在的文件，就显示“OK.”；否则就显示"No such file."

练习：写一个脚本
给脚本传递两个参数(整数)；
显示此两者之和，之乘积；
#!/bin/bash
#
if [ $# -lt 2 ]; then
  echo "Usage: cacl.sh ARG1 ARG2"
  exit 8
fi

echo "The sum is: $[$1+$2]."
echo "The prod is: $[$1*$2]."

	
练习：写一个脚本，完成以下任务
1、使用一个变量保存一个用户名；
2、删除此变量中的用户，且一并删除其家目录；
3、显示“用户删除完成”类的信息；

变量名称：

	1、只能包含字母、数字和下划线，并且不能数字开头；
	2、不应该跟系统中已有的环境变量重名；
	3、最好做到见名知义；

## bash变量类型

根据变量生效范围等划分变量类型：set：查看所有变量（全局变量，局部变量还有函数）

- 环境变量
- 本地变量
- 局部变量
- 位置变量
- 特殊变量

### 环境变量(全局变量)

- 生效范围为当前shell进程及其子进程

- $HOME/.bash_profile(/etc/profile)

- 设置环境变量

```bash
# 第一种定义方法
VARNAME=VALUE
export VARNAME
# 第二种定义方法
export VARNAME=VALUE
# 第三种定义方法
declare -x VARNAME=VALUE
```

- 查看环境变量

```bash
printenv
env
export
```

PATH：命令搜索路径

HISTSIZE: 命令历史缓冲区大小

### 本地变量

- 作用域：当前bash进程生命周期
- VARNAME=VALUE
- set 显示本地所有的变量 readonly -p
- readonly variable 使变量只读

### 局部变量

局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量。

bash的变量默认都是全局变量，使用local关键词，可以定义只在函数内有效的局部变量，函数执行结束后，变量消失。

使用local，就相当于在函数开始的时候定义变量，在函数返回之前做unset。

local VARNAME=VALUE：作用域为当前代码段；

### 位置变量

用于让脚本在脚本代码中调用通过命令行传递给它的参数

$0 | $1 | $2 | ...
-|:-:|:-:|-
脚本名| first | second | third

### 特殊变量(预定义变量)

shell预先定义的特殊变量，不能重定义它。所有预定义变量都是由$符和另一个符号组成的，常用的shell预定义变量有：

- $?：显示上一个命令的退出状态。0表示正确执行，非0值表示执行有误
- $#：脚本的参数个数
- $*：脚本的全部参数
- $$：当前进程ID号，可用pstree -p验证
- $PPID :父进程编号
- $!：后台运行的最后一个进程号
- $0：当前执行的进程名
- $@：参数列表，$@ 跟$*类似，但是可以当作数组用

$@ 和 $* 只在被双引号包起来的时候才会有差异

双引号括起来的情况：
$*将所有的参数认为是一个字段
$@以 默认为空格 来划分字段，如果空格在“”里面，不划分。

没有括起来的情况是$@和$*一样的，见到 空格 就划分字段

程序执行，可能有两类返回值：

    程序执行结果
    程序状态返回代码（0-255）
        0: 正确执行
        1-255：错误执行，1，2，127系统预留

“$$”变量最常见的用途是用作临时文件的名字以保证临时文件不会重复。

### 变量替换

- ${variable name} 变量值
- ${variable name:+value} 如果设置了variable name，则显示其值value；否则为空
- ${variable name:?message} 如果未设置variable name，则显示message
- ${variable name:-message} 如果未设置variable name，则显示message；否则为空  
- ${variable name:=value} 如果未设置variable name，则设置其值value；否则为空

### 变量清除

- unset VARNAME
- -- 表明选项结束
- -f 删除只读变量，但不能删除保留的环境变量

### 标准变量

- /etc/profile
- EXINIT vi的参数
- HOME 主目录
- IFS 系统默认间隔符
- LOGNAME 登录名
- MAIL 当前用户邮箱位置
- MAILCHECK 每隔多少秒检查是否有新邮件
- TERM 终端类型
- PATH 可执行文件寻找的路径
- TZ 时区
- PS1 提示符

变量赋值：name=‘value’

可以使用引用value:

    (1) 可以是直接字串; name=“root"
    (2) 变量引用：name="$USER" 或者 name=${name}
    (3) 命令引用：name=`COMMAND` name=$(COMMAND)

变量引用：${name} 或者 $name

    ""：弱引用，其中的变量引用会被替换为变量值
    ''：强引用，其中的变量引用不会被替换为变量值，而保持原字符串

## 影响变量的命令

### declare （与typeset相同）

- -i interger，创建整数变量
- -x 创建export变量
- 设置或者显示变量
- -f 只显示函数名
- -r 创建只读变量
- 使用+代替-，可以颠倒选项的含义

### export

- 用于创建传递给子shell的变量
- -p 显示全局变量列表

### readonly

- 用于显示或者设置只读变量
- -- 表明选项结束
- -f 创建只读变量

### set

set用于设置各种shell

set -C: 禁止对已经存在文件使用覆盖重定向；强制覆盖输出，则使用 >|

set +C: 关闭上述功能

### shift [n]

- 移动位置变量，后面参数往前移动n位