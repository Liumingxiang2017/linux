# 控制流结构

面向过程控制结构

-	顺序结构
-	选择结构
-	循环结构

## 选择结构if case

### if选择结构

if:单分支，双分支，多分支

#### 单分支if语句

if CONDITION; then
  statement1
  statement2
  ...
fi

#### 双分支的if语句：

if CONDITION; then
    statement1
    statement2
    ...
else
    statement3
    statement4
    ...
fi

#### 多分支的if语句：
if CONDITION1; then
  statement1
  ...
elif CONDITION2; then
  statement2
  ...
elif CONDITION3; then
  statement3
  ...
else
  statement4
  ...
fi

```shell
if [];then
    command1
elif [];then
    command2
else
    command3
fi
```

### case选择结构

```shell
case SWITCH in
value1)
    statement1
    ;;
value2)
    statement2
    ;;
*)
    statement3
    ...
    ;;
esac
```

a-z
A-Z
0-9
[abc]



只接受参数start,stop,restart,status其中之一
#!/bin/bash
#
DEBUG=0
ADD=0
DEL=0

for I in `seq 0 $#`; do
  if [ $# -gt 0 ]; then
	  case $1 in
	  -v|--verbose)
		DEBUG=1
		shift ;;
	  -h|--help)
		echo "Usage: `basename $0` --add USER_LIST --del USER_LIST -v|--verbose -h|--help"
		exit 0
		;;
	  --add)
		ADD=1
		ADDUSERS=$2
		shift 2
		;;
	  --del)
		DEL=1
		DELUSERS=$2
		shift 2
		;;
	  *)
		echo "Usage: `basename $0` --add USER_LIST --del USER_LIST -v|--verbose -h|--help"
		exit 7
		;;
    esac
  fi
done

if [ $ADD -eq 1 ]; then
  for USER in `echo $ADDUSERS | sed 's@,@ @g'`; do
    if id $USER &> /dev/null; then
      [ $DEBUG -eq 1 ] && echo "$USER exists."
    else
      useradd $USER
      [ $DEBUG -eq 1 ] && echo "Add user $USER finished."
    fi
  done
fi

if [ $DEL -eq 1 ]; then
  for USER in `echo $DELUSERS | sed 's@,@ @g'`; do
    if id $USER &> /dev/null; then
      userdel -r $USER
      [ $DEBUG -eq 1 ] && echo "Delete $USER finished."
    else
      [ $DEBUG -eq 1 ] && echo "$USER not exist."
    fi
  done
fi

练习：写一个脚本showlogged.sh，其用法格式为：
showlogged.sh -v -c -h|--help
其中，-h选项只能单独使用，用于显示帮助信息；-c选项时，显示当前系统上登录的所有用户数；如果同时使用了-v选项，则既显示同时登录的用户数，又显示登录的用户的相关信息；如
Logged users: 4. 

They are:
root     tty2         Feb 18 02:41
root     pts/1        Mar  8 08:36 (172.16.100.177)
root     pts/5        Mar  8 07:56 (172.16.100.177)
hadoop   pts/6        Mar  8 09:16 (172.16.100.177)

#!/bin/bash
#
declare -i SHOWNUM=0
declare -i SHOWUSERS=0

for I in `seq 1 $#`; do
  if [ $# -gt 0 ]; then
    case $1 in
    -h|--help)
      echo "Usage: `basename $0` -h|--help -c|--count -v|--verbose"
      exit 0 ;;
    -v|--verbose)
      let SHOWUSERS=1
      shift ;;
    -c|--count)
      let SHOWNUM=1
      shift ;;
    *)
      echo "Usage: `basename $0` -h|--help -c|--count -v|--verbose"
      exit 8 ;;
    esac
  fi
done

if [ $SHOWNUM -eq 1 ]; then
  echo "Logged users: `who | wc -l`."
  if [ $SHOWUSERS -eq 1 ]; then
    echo "They are:"
    who
  fi
fi

## 循环结构

进入条件，退出条件

for while until

### for

```shell
for 变量 in 列表; do
  循环体
done

for variable in list
do
    command1
done

for I in 1 2 3 4 5 6 7 8 9 10; do
  加法运算
done

```

如何生成列表list：

- 1 2 3..
- {1..100}
- orange red bule
- "orange red blue"
- `cat filename`
- `seq [起始数 [步进长度]] 结束数`

## until

```shell
until condition
do
    command1
done
# 至少执行一次

#举例
#!bin/bash
#监控分区
Part="/backup"
LOOK_OUT=`df|grep "$Part"|awk '{print $5}'|sed 's/%//g'`
echo $LOOK_OUT
until [ "$LOOK_OUT" -gt "90" ]
do
    echo "Filesystem /backup is nearly full"|mail root
    LOOK_OUT=`df|grep "$Part"|awk '{print $5}'|sed 's/%//g'`
    sleep 3600
done
```

## while

```shell
while [condition]
do
    command1
done

#举例
#!/bin/bash
while read LINE
do
    echo $LINE
done < name.txt
```

## break and continue

- break [n]
  - n表示几层循环
- continue

## 模式匹配符

- *表示任意字符
- ?表示任意单个字符
- [..]表示范围中任意字符

写一个脚本：
1、设定变量FILE的值为/etc/passwd
2、依次向/etc/passwd中的每个用户问好，并显示对方的shell，形如：  
	Hello, root, your shell: /bin/bash
3、统计一共有多少个用户

for I in `seq 1 $LINES`; do echo "Hello, `head -n $I /etc/passwd | tail -1 | cut -d: -f1`"; done

只向默认shell为bash的用户问声好


写一个脚本：
1、添加10个用户user1到user10，密码同用户名；但要求只有用户不存在的情况下才能添加；

扩展：
接受一个参数：
add: 添加用户user1..user10
del: 删除用户user1..user10
其它：退出
adminusers user1,user2,user3,hello,hi



写一个脚本：
计算100以内所有能被3整除的正整数的和；
取模，取余:%
3%2=1
100%55=45

写一个脚本：
计算100以内所有奇数的和以及所有偶数的和；分别显示之；

let I=$[$I+1]
SUM=$[$SUM+$I]

let SUM+=$I

let I+=1 相当于 let I++

-=
	let I-=1 相当于 let I--
	
	++I, --I

*=
/=
%=



写一个脚本，分别显示当前系统上所有默认shell为bash的用户和默认shell为/sbin/nologin的用户，并统计各类shell下的用户总数。显示结果形如：
BASH，3users，they are:
root,redhat,gentoo

NOLOGIN, 2users, they are:
bin,ftp


#!/bin/bash
#
NUMBASH=`grep "bash$" /etc/passwd | wc -l`
BASHUSERS=`grep "bash$" /etc/passwd | cut -d: -f1`
BASHUSERS=`echo $BASHUSERS | sed 's@[[:space:]]@,@g'`

echo "BASH, $NUMBASH users, they are:"
echo "$BASHUSERS

