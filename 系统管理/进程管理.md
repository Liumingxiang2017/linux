# 进程管理

## 进程和进程控制

### 查看进程状态

w

- w username 查看某个用户的进程 

ps - report a snapshot of the current processes

- a 显示所有用户进程
- u 显示用户名和启动时间
- x 显示没有控制终端的进程
- e 显示所有进程，包括没有控制终端的进程
- l 长格式显示
- 常用格式 ps aux，ps el
- PPID 父进程的进程号
- TTY 进程启动的终端，?
- STAT 进程当前状态
  - S 休眠
  - D 不可中断的休眠
  - R 运行
  - Z 僵死，即没有父进程的子进程
  - T 停止
- NI 进程优先级
- TIME 进程启动以来使用CPU总时间
- --sort pid 可以按pid、时间等排序

### 杀死进程

kill

- kill pid 杀死进程
- kill -l 显示所有信号
- kill -s signal pid 向对应pid的进程发送信号

killall servicename 杀死所有与服务名相关的进程

xkill 图形界面下杀死进程，输入命令后鼠标点击的窗口将关闭

ctrl+alt+backspace 图形界面死掉时，用于关闭图形界面

### 进程优先级（-20~19）

nice -n command 指定程序运行优先级

renice n pid  改变正在运行的进程优先级

top 进程状态实时显示（每5秒钟刷新）和进程控制

- top -d n 间隔n秒刷新
- top -c 显示命令完整路径
- h 查看使用帮助
- k 终止程序进程
- u 查看用户进程
- r 重新设置优先级
- s 设置刷新时间间隔

### 后台

command & 准备运行命令时使其后台运行

ctrl+z 命令开启后使其后台运行

ctrl+c 中断进程

jobs 查看后台进程

fg n 将标识号为n的后台进程转到前台

bg n 使用其他终端再将n转到后台运行

## 一次性安排进程

at 安排作业再某一时刻执行一次

batch 安排作业在系统负载不重时执行一次

### 使用at步骤

1. 安装at并开启atd服务
    - yum install at -y
    - service atd start
2. 编辑任务
    - at timepoint
    - 在timepoint执行某个程序，必须使用绝对路径
        1. 绝对计时方法
            - midnight noon teatime
            - HH:MMpm
            - HH:MM[today]，HH:MM tomorrow
            - HH:MM 星期
            - HH:MM mm/dd/yyyy 
            - HH:MM dd.mm.yyyy
        2. 相对计时方法
            - now + n minutes
            - now + n hours
            - now + n day
    - ctrl+d 退出编辑
    - at -f filename timepoint 使用编辑好命令的文件
    - at < filename timepoint 使用命令文件重定向到at
3. 查看任务
    - at -l 或者atq查看有哪些任务
4. 删除任务
    - at -d 标识符 （atrm 标识符）
5. at的执行结果
    - at的执行结果会通过邮件提交给用户
6. at的配置文件
    - 限制哪些用户可以使用at命令
    - /etc/at.allow, 这个文件存在，只有列在此文件中的用户可以使用at命令，如果不存在，则查/etc/at.deny
    - /etc/at.deny，如果这个文件存在，则在此文件中列出的用户都不能使用at命令
    - 如果两个文件都不存在，则只有root用户可以使用at，如果都存在而且均为空，则所有用户都可以使用at命令。

## 周期性安排进程任务

crond

1. 开启服务
    - service crond start
    - crond 进程搜索crontab文件并载入内存
    - crontab文件即/var/spool/cron/目录下以用户名命名的文件
    - crond 进程启动以后，将首先检查用户是否设置了crontab文件，如果有则每分钟检查crontab文件是否有需要执行的命令，命令执行结束后，任何输出都将作为邮件发送给crontab的所有者；如果没有转入“休眠”状态，释放系统资源。