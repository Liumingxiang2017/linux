# 文件权限管理

## 变换登录身份

su userName  登录身份转变，但环境变量仍然是原用户的

su - userName  登录身份完全转变，包括环境变量

只允许root登录：在/etc/目录建立一个名为nologin空文件

## 权限管理

chmod

- -R 改变目录及子目录权限

chown 更改属主

- -R 改变目录及子目录的属主

- chown userName.grpName fileOrDirectory 同时改变属主属组

chgrp 更改属组

- -R 更改目录及子目录下属组

umask 设置掩码

文件默认不能具有执行权限，如果算得的结果中有执行权限，则将其权限加1；

## 普通权限

代表字符|权限|对文件的含义|对目录的含义
-|:-:|:-:|:-:
r|读|查看文件内容，cat|列出目录内容,ls列出内部文件
w|写|修改或删除文件内容|可以在目录中创建、删除文件
x|执行|execuatable，当做命令提交给内核|cd进入目录，ls -l查看详细信息

如何授权普通用户对管理员创建的目录有写权限？

1. groupadd webadmin
2. gpasswd -a username webadmin
3. chgrp webadmin /perm
4. chmod g+w /perm

## 特殊权限

文件特殊权限

- SUID: s 4
- SGID: s 2
- Sticky: t 1

7654 rwSr-sr-T

5764 rwsrw-r-T

### SUID (SetUID)

当一个命令具有SetUID权限，普通用户在执行此命令是，将以这个命令所有者的身份执行。

SUID: 运行某程序时，相应进程的属主是程序文件自身的属主，而不是启动者；

chmod u+s FILE
chmod u-s FILE
如果FILE本身原来就有执行权限，则SUID显示为s；否则显示S；

/bin/vi 设置chmod u+s /bin/vi 等于可以编辑所有文件。

### SGID

SGID: 文件加上SGID，其是所属组将与其上一级目录的所属组相同，便于文件分享
（次要作用：运行某程序时，相应进程的属组是程序文件自身的属组，而不是启动者所属的基本组；）

chmod g+s FILE
chmod g-s FILE

### Sticky粘着位t（保护位）

当权限为777的目录被授予粘着位，那么每个用户只能在此目录下删除自己是所有者的文件。

Sticky: 在一个公共目录，每个都可以创建文件，删除自己的文件，但不能删除别人的文件；

chmod o+t DIR
chmod o-t DIR

/tmp就是这样的一个目录 drwxrwxrwt

## 隐藏权限

### chattr 设置

root用户也会受到隐藏权限限制，选项前+表示添加权限，-表示取消权限。

- +i 不可删除，不可修改

- +a 只可追加，可以用于日志文件，比如/var/log/messages

### lsattr 查看

## FACL

FACL：Filesystem Access Control List 文件系统访问控制列表 
利用文件扩展保存额外的访问控制权限

### setfacl 设定facl

- -m: 设定
  - -u:UID:perm
  - -g:GID:perm
- -x: 取消
  - -u:UID
  - -g:GID
- -b: Remove all
- -R 对于目录

### getfacl 查看facl

案例：负责权限分配管理

```shell
# vi /etc/fstab
mount -o remount,acl /home
setfacl -m u:userName:rwx fileName
getfacl fileName

#有facl权限，文件会发生变化
所属组变成设置的facl属性，点号变加号
```

## su与sudo授权

## su 切换用户

switch user

- su [-] 用户名
- su student 半切换
- su - student 完全切换

## sudo 授权

visudo 或者 vi /etc/visudoers

不可以给普通用户授权vim

案例：管理员授权普通用户管理Apache

```bash
# 配置文件是/etc/sudoers,必须是root用visudo来编辑
visudo
userName hostName=(以谁的身份) command1,command2...
# 命令需要时全路径；不需要重启即可生效
# userName ALL=NOPASSWD: commandList 执行sudo时不需要密码验证。
# %groupname
sudo command1
# 查看sudo命令 sudo -l

# 安装apache
tar zxvf apache.tar.gz
./configure --prefix=/apache （检查）
make （编译成可执行文件）
make install (复制文件)
# 1.启动关闭Apache
# 2. 能修改Apache配置i文件
# 3. 能更新网页文件
gerp DocumentRoot /apache/conf/httpd  
# DocumentRoot "apache/htdocs"
visudo
username hostname=/apache/bin/apachectl,/bin/vi /apache/conf/httpd.conf
chown username /apache/htdocs
# 启动
/apache/bin/apachectl start
```

