# 用户及用户组管理

安全上下文(secure context)：

SELinux 管理过程中，进程是否可以正确地访问文件资源，取决于它们的安全上下文。

## 用户管理

用户类别：
管理员（超级用户）：UID值0，root，具有操作系统一切权限
普通用户： 1-65535
    伪(系统)用户：UID值1-499，为了方便系统管理，满足相应系统进程文件属主的要求，不能登录
    一般（普通）用户：UID值500-60000，普通用户具有有限权限

用户组类别：
管理员组：
普通组：
    系统组：
    一般组：

用户组类别：
    私有组：创建用户时，如果没有为其指定所属的组，系统会自动为其创建一个与用户名同名的组
    基本组：用户的默认组
    附加组：额外组：默认组以外的其它组

/etc/passwd 用户账号配置文件，分7部分：

    用户名：密码：UID:GID：注释：家目录：默认SHELL
    account:password:UID:GID:comment:home dir:shell

1. account 账号名称
2. password 密码，x说明有密码，删掉就不需要密码了
3. UID
4. GID 基本组ID
5. comment 注释信息
6. HOME DIR 家目录
7. shell

/etc/shadow 用户密码文件，只有root可读，分9个字段:

    用户名：密码：最近一次修改密码的时间：最短使用期限：最长使用期限：警告时间：非活动时间：过期时间：保留字段

1. account 用户名
2. encrypted password 加密密码（*或者！！表示该用户没有密码，或者在某个用户前面加上！让其密码失效，让该用户无法登录）
3. 最后修改时间（以时间戳的形式，以1970年1月1日为起始日期）
4. 修改密码的间隔时间（距离上一次修改密码间隔多少天才能修改）
5. 密码的有效期，默认9999天，可以更改
6. 密码提醒时间（表示在密码失效时间的前面几天提示更改密码，以密码失效时间的最后几天开始算）失效后禁止登录
7. 密码宽限时间（密码过期后几天仍然可以使用并且提示更改密码）过了这个时间后禁止登录（0或者没有表示没有宽限时间，-1表示永久生效）
8. 账号失效时间，时间戳为单位。没填表示永久生效
9. 保留字段

影子口令：

用户：/etc/shadow

组：/etc/gshadow

加密方法：

对称加密：加密和解密使用同一个密码

公钥加密：每个密码都成对儿出现，一个为私钥(secret key)，一个为公钥(public key)

单向加密，散列加密：提取数据特征码，常用于数据完整性校验

    1、雪崩效应
    2、定长输出
        MD5：Message Digest, 128位定长输出
        SHA1：Secure Hash Algorithm, 160位定长输出

### 用户管理命令

useradd, userdel, usermod, passwd, chsh, chfn, finger, id, chage

创建步骤

1. 在/etc/passwd中添加一条记录
2. 创建用户家目录，并更改权限
3. 在用户家目录中配置设置文件
4. 设置用户初始口令

useradd或者adduser 创建用户

    useradd  [options]  USERNAME
        -u UID,指定用户UID，默认值是上一个UID+1
        -g GUI,指定GID（基本组）
        -G 指定附加组
        -c comment,指定用户说明
        -d directory,指定家目录
        -s shell,指定shell
        -m -k
        -M
        -r: 添加系统用户

/etc/login.defs 定义/etc/passwd中的一些默认值

/etc/shells：指定了当前系统可用的安全shell

passwd 设置密码

    passwd [options] [USERNAME]

    --stdin
    -l 停止账号使用
    -u 启用已被停止的账户
    -d 删除用户密码

userdel

    userdel [option] USERNAME
        userdel username, 删除用户，但不会删除家目录
        -r: 同时删除用户的家目录

usermod

- usermod -l new_username old_username 只改用户名，不改变家目录
- -L 锁定用户，等于在/etc/shadow对应字段前加一个！
- -U 解锁用户

/etc/skel 创建家目录时默认创建内容

## 用户组的管理

用户组分为：私有组 标准组

/etc/group 组配置文件，三个冒号分为4部分：

1. 组名
2. 组密码
3. GID
4. 组成员

- 增加组：groupadd groupname

- 更改组账号名：groupmod -n newGroupName oldGroupName

- 删除组账号：groupdel groupName 组必须存在，且不能是私有组。

- 添加用户到组：gpasswd -a userName groupName

- 从组中删除用户：gpasswd -d userName groupName

- 查看用户所在组: groups userName

### 用户组管理命令

groupadd, groupdel, groupmod, gpasswd

groupadd

    -g GID
    -r：添加为系统组

groupdel

groupmod

    -g GID
    -n GRPNAME

gpasswd：为组设定密码

newgrp GRPNAME <--> exit

id
    查看用户的帐号属性信息
    id userName
    -u
    -g
    -G
    -n

finger

    查看用户帐号信息，包括用户家目录、启动shell、用户名
    finger USERNAME

## 权限管理

常用命令：chown, chgrp, chmod, umask

chown, chgrp, chmod
    -R
    --reference=

chown

    改变文件属主(只有管理员可以使用此命令)
    chown USERNAME:GRPNAME file,...
    -R: 修改目录及其内部文件的属主
    --reference=/path/to/somefile file,...

chgrp

    chgrp GRPNAME file,...
    -R
    --reference=/path/to/somefile file,...

chmod

    修改文件三类用户的权限
    chmod MODE file,...
        -R
        --reference=/path/to/somefile file,...
    
    修改某类用户或某些类用户权限：
    u,g,o,a
    chmod 用户类别=MODE file,...

    修改某类用户的某位或某些位权限：
    u,g,o,a
    chmod 用户类别+|-MODE file,...

usermod

    修改用户帐号属性
    -u UID 
    -g GID
    -a -G GID：不使用-a选项，会覆盖此前的附加组；
    -c
    -d -m：
    -s
    -l
    -L：锁定帐号
    -U：解锁帐号

chsh: 修改用户的默认shell

chfn：修改注释信息

pwck：检查用户帐号完整性

chage
    -d: 最近一次的修改时间
    -E: 过期时间
    -I：非活动时间
    -m: 最短使用期限
    -M: 最长使用期限
    -W: 警告时间

练习：

1、创建一个用户mandriva，其ID号为2002，基本组为distro（组ID为3003），附加组为linux；

    groupadd -g 3003 distro
    groupadd linux
    useradd -u 2002 -g distro -G linux mandriva

2、创建一个用户fedora，其全名为Fedora Community，默认shell为tcsh；

    useradd -c "Fedora Community" -s /bin/tcsh fedora

3、修改mandriva的ID号为4004，基本组为linux，附加组为distro和fedora；

    usermod -u 4004 -g linux -G distro,fedora mandriva

4、给fedora加密码，并设定其密码最短使用期限为2天，最长为50天；

    passwd -n 2 -x 50 fedora
5、将mandriva的默认shell改为/bin/bash;

    usermod -s /bin/bash mandirva

6、添加系统用户hbase，且不允许其登录系统；

    useradd -r -s /sbin/nologin hbase

练习：

1、新建一个没有家目录的用户openstack；

    useradd -M openstack

2、复制/etc/skel为/home/openstack；

    cp -r /etc/skel /home/openstack

3、改变/home/openstack及其内部文件的属主属组均为openstack；

    chown -R openstack:openstack /home/openstack

4、/home/openstack及其内部的文件，属组和其它用户没有任何访问权限

    chmod -R go= /home/openstack