# 文件管理

## 文件查找

locate

非实时，模糊匹配，查找是根据全系统文件数据库进行的；

updatedb, 手动生成文件数据库

优点：速度快

find：
	实时
	精确
	支持众多查找标准
	遍历指定目录中的所有文件完成查找，速度慢；
	
find 查找路径 查找标准 查找到以后的处理运作

find DIRECTORY CRETIRIA ACTION

查找路径：默认为当前目录
查找标准：默认为指定路径下的所有文件
处理运作：默认为显示

匹配标准：
	-name 'FILENAME'：对文件名作精确匹配
		文件名通配：
			*：任意长度的任意字符
			?
			[]
	-iname 'FILENAME': 文件名匹配时不区分大小写
	-regex PATTERN：基于正则表达式进行文件名匹配
	
	-user USERNAME: 根据属主查找
	-group GROUPNAME: 根据属组查找
	
	-uid UID: 根据UID查找
	-gid GID: 根据GID查找
	
	-nouser：查找没有属主的文件
	-nogroup: 查找没有属组的文件
	
	-type 
		f: 普通文件
		d: 目录
		c
		b: 块文件
		l: 链接
		p: 管道
		s: 套接字
	
	-size [+|-]
		#k
		#M
		#G
		
组合条件：
	-a
	-o
	-not 

    \(\)
	
/tmp目录，不是目录，并且还不能套接字类型的文件
/tmp/test目录下，属主不是user1，也不是user2的文件；

	-mtime
	-ctime
	-atime
		[+|-]#
	-mmin
	-cmin
	-amin
		[+|-]#
		
	-perm MODE：精确匹配
		/MODE: 任意一位匹配即满足条件
		-MODE: 文件权限能完全包含此MODE时才符合条件
		
		-644
		644: rw-r--r--
		755: rwxr-xr-x
		750: rwxr-x---
	find ./ -perl -001


运作：
	-print: 显示
	-ls：类似ls -l的形式显示每一个文件的详细
	-ok COMMAND {} \; 每一次操作都需要用户确认
	-exec COMMAND {} \;
	
1、查找/var目录下属主为root并且属组为mail的所有文件；
find /var -user root -group mail

2、查找/usr目录下不属于root,bin,或student的文件；
find /usr -not -user root -a -not -user bin -a -not -user student
find /usr -not \( -user root -o -user bin -o -user student \)

3、查找/etc目录下最近一周内内容修改过且不属于root及student用户的文件；
find /etc -mtime -7 -not \ ( -user root -o -user student \)
find /etc -mtime -7 -not -user root -a -not -user student


4、查找当前系统上没有属主或属组且最近1天内曾被访问过的文件，并将其属主属组均修改为root；
find / \( -nouser -o -nogroup \) -a -atime -1 -exec chown root:root {} \; 

5、查找/etc目录下大于1M的文件，并将其文件名写入/tmp/etc.largefiles文件中；
find /etc -size +1M >> /tmp/etc.largefiles

6、查找/etc目录下所有用户都没有写权限的文件，显示出其详细信息；
find /etc -not -perm /222 -ls	


练习：写一个脚本
写一个脚本，显示当前系统上shell为-s指定类型的用户，并统计其用户总数。-s选项后面跟的参数必须是/etc/shells文件中存在的shell类型，否则不执行此脚本。另外，此脚本还可以接受--help选项，以显示帮助信息。脚本执行形如：
./showshells.sh -s bash
显示结果形如：
BASH，3users，they are:
root,redhat,gentoo


#!/bin/bash
#
if [ $1 == '-s' ]; then
  ! grep "${2}$" /etc/shells &> /dev/null && echo "Invalid shell." && exit 7
elif [ $1 == '--help' ];then
  echo "Usage: showshells.sh -s SHELL | --help"
  exit 0
else
  echo "Unknown Options."
  exit 8
fi

NUMOFUSER=`grep "${2}$" /etc/passwd | wc -l`
SHELLUSERS=`grep "${2}$" /etc/passwd | cut -d: -f1`
SHELLUSERS=`echo $SHELLUSERS | sed 's@[[:space:]]@,@g'`

echo -e "$2, $NUMOFUSER users, they are: \n$SHELLUSERS"

${变量名}


ln [-s -v] SRC DEST


硬链接：
	1、只能对文件创建，不能应用于目录；
	2、不能跨文件系统；
	3、创建硬链接会增加文件被链接的次数；
	
符号链接：
	1、可应用于目录；
	2、可以跨文件系统；
	3、不会增加被链接文件的链接次数；
	4、其大小为指定的路径所包含的字符个数；

设备文件：
	b: 按块为单位，随机访问的设备；
	c：按字符为单位，线性设备；
	
	b: 硬盘
	c: 键盘

/dev
	主设备号 （major number）
		标识设备类型
	次设备号 （minor number）
		标识同一种类型中不同设备