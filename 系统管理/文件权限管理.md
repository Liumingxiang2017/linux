# 文件权限管理

## 变换登录身份

su userName  登录身份转变，但环境变量仍然是原用户的

su - userName  登录身份完全转变，包括环境变量

只允许root登录：在/etc/目录建立一个名为nologin空文件

## 权限管理

chmod 

- -R 改变目录及子目录权限

chown 更改属主

- -R 改变目录及子目录的属主

- chown userName.grpName fileOrDirectory 同时改变属主属组

chgrp 更改属组

- -R 更改目录及子目录下属组

umask 设置掩码

## 文件目录权限总结

代表字符|权限|对文件的含义|对目录的含义
-|:-:|:-:|:-:
r|读|查看文件内容|列出目录内容
w|写|修改文件内容|可以在目录中创建、删除文件
x|执行|执行文件|进入目录

如何授权普通用户对管理员创建的目录有写权限？

1. groupadd webadmin
2. gpasswd -a username webadmin
3. chgrp webadmin /perm
4. chmod g+w /perm

## 特殊权限

### SetUID

当一个命令具有SetUID权限，普通用户在执行此命令是，将以这个命令所有者的身份执行。

/bin/vi 设置chmod u+s /bin/vi 等于可以编辑所有文件。

### 粘着位t（保护位）

当权限为777的目录被授予粘着位，那么每个用户只能在此目录下删除自己是所有者的文件。

/tmp就是这样的一个目录

### chattr

案例：管理员也无法删除的文件

+i 不可删除，不可修改

+a 只可追加，可以用于日志文件，比如/var/log/message

lsattr 查看隐藏权限

## 授权

sudo

案例：管理员授权普通用户管理Apache

```bash
# 配置文件是/etc/sudoers,必须是root用visudo来编辑
visudo
username hostname=commad1,command2
# %groupname
sudo command1
# 查看sudo命令 sudo -l

# 安装apache
tar zxvf apache.tar.gz
./configure --prefix=/apache （检查）
make （编译成可执行文件）
make install (复制文件)
# 1.启动关闭Apache
# 2. 能修改Apache配置i文件
# 3. 能更新网页文件
gerp DocumentRoot /apache/conf/httpd  
# DocumentRoot "apache/htdocs"
visudo
username hostname=/apache/bin/apachectl,/bin/vi /apache/conf/httpd.conf
chown username /apache/htdocs
# 启动
/apache/bin/apachectl start
```

## 复杂权限控制：ACL

案例：负责权限分配管理

```shell
# vi /etc/fstab
mount -o remount,acl /home
setfacl -m u:username:rwx filename
getfacl filename

```
