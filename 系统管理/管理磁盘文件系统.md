# 管理磁盘文件系统

## 分区和格式化

分区表：MBR即主引导记录，位于磁盘0柱面，0扇区，0磁道，共446byte，另外64byte记录分区，记录一个分区16byte，所以主分区最多4个。

fdisk

- -l 查看系统硬盘

df

- 查看已挂载分区
- -T 类型, df -T是常用命令
- -H 优化单位

## 使用fdisk分区

## 使用mkfs创建文件系统

## 挂载

### 挂载外部存储设备

1. 挂载设备： mount 设备 挂载目录
2. 读写设备
3. 卸载设备： mount 挂载目录/设备
4. 拔掉设备

挂载目录最好是空目录，非空目录虽然也能挂载，但是其他内容在挂载后会消失。

### 挂载硬盘

硬盘是特殊的块设备，需要分区格式化后才能使用。

1. 分区
2. 格式化
3. 挂载分区
4. 读写挂载点
5. 卸载分区

### 挂载U盘

- U盘是USB设备，内置USB-SCSI转换接口，所以被认为是SCSI硬盘

- 需要事先驱动， # modprobe usb-storage

### 文件系统类型

- NTFS格式默认的内核不识别， mount -t ntfs /dev/hda3 /mnt/d

### 挂载选项

windows分区常用挂载选项，iocharset=\<charset\>

存在中文时，设置文件系统的字符编码常用值为gb2312和utf8

mount -t vfat -o iocharset=gb2312 /dev/hda3 /mnt/one

mount -t vfat -o utf8 /dev/hda3 /mnt/one

- -o rw/ro 读写/只读

- -o uid=username,gid=gourpname 设置属主属组

- -o umask=0077 设置挂载点的文件权限掩码

## 磁盘配额

限制普通用户使用的磁盘空间和创建文件的个数。

1. 需要程序quota软件包

    - rpm -qa | grep quota

2. 使用userquota,grpquota选项挂载一个分区，激活内核支持

    - mount -o userquota,grpquota /dev/sda2 /mnt/one

    - mount -o remount,usrquota,grpquota /dev/sda1 /  根目录重新挂载必须使用remount

    - 确保对应目录没有其他用户使用，或直接使用单用户模式init 1

    - 编辑/etc/fstab，自动挂载永久生效，注意备份并小心修改。

3. 检查创建磁盘配额数据库文件

    - quotacheck -cvug 

        - -c 创建，-v过程可视化，-u用户，-g组

    - quotacheck -cvuga

        - -a表示所有/etc/fstab文件中含有usrquota,grpquota选项的磁盘都创建数据库文件

4. 开启

    - 激活全部 quotaon -a

    - 激活选定 quotaon /dev/sda2

5. 编辑

    - 编辑指定用户：edquota -u username 

    - 编辑文件，只需要编辑soft，hard字段，其单位默认为K

    - 编辑grace宽限时间，默认时7天：edquota -t 

6. 查看

    - 查看自己当前用户： quota

    - 管理员查看所有磁盘配额： repquota -a

7. 测试

    - dd if=/dev/zero of=filename bs=1k count=1024

8. 关闭

    - 管理员关闭所有配额： quotaoff /dev/sda2